<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>ğŸŒ TAAA Semanticâ€“Co-Word Analyzer</title>
<style>
body {
  font-family: 'Segoe UI', 'Noto Sans TC', sans-serif;
  background: #fafafa;
  text-align: center;
  margin: 50px;
}
.container {
  background: #fff;
  padding: 30px;
  border-radius: 14px;
  box-shadow: 0 2px 10px rgba(0,0,0,0.1);
  display: inline-block;
  width: 460px;
}
h1 { margin-top: 0; color: #2a2a2a; }
h2 { color: #555; font-weight: 400; margin-top: -5px; }
label { font-weight: bold; }
button {
  margin-top: 15px;
  background: #0066cc;
  color: white;
  border: none;
  padding: 10px 24px;
  border-radius: 6px;
  cursor: pointer;
  font-size: 15px;
}
button:hover { background: #004a99; }
select, input[type=file] { margin-top: 10px; }
.spinner { display: none; margin-top: 20px; font-style: italic; color: #555; transition: 0.3s; }
.indicator { margin-top: 10px; font-size: 14px; color: #777; }
footer { margin-top: 30px; font-size: 13px; color: #888; }
.lang-toggle { margin-top: 10px; cursor: pointer; font-size: 13px; color: #1a73e8; }
</style>
</head>
<body>
<div class="container">
  <h1 id="title">ğŸŒ TAAA Semanticâ€“Co-Word Analyzer</h1>
  <h2 id="subtitle">Multilingual Semantic Network & TAAA Theme Assignment Tool</h2>

  <form id="uploadForm" enctype="multipart/form-data">
    <label id="modeLabel" for="mode">Select Analysis Mode:</label><br>
    <select id="mode" name="mode">
      <option value="abstract">ğŸ§  Abstract Mode</option>
      <option value="coword">ğŸ¾ Co-Word Mode</option>
    </select><br><br>

    <input type="file" id="file" name="file" accept=".csv" required><br>
    <button type="submit" id="analyzeBtn">ğŸš€ Analyze</button>
  </form>

  <div class="spinner" id="spinner">â³ Processingâ€¦ please wait</div>
  <div class="indicator" id="engineIndicator">ğŸ” Engine: detectingâ€¦</div>
  <div id="resultLink"></div>

  <div class="lang-toggle" id="toggleLang">ğŸŒ ä¸­æ–‡é¡¯ç¤º / English</div>

  <footer id="footer">
    Try Abstract Mode with multilingual texts or Co-Word Mode with animal attributes<br>
    Â© 2025 Smile Chien Â· TAAA Semanticâ€“Co-Word Analyzer v6.1
  </footer>
</div>

<script>
// ======== Language Packs ========
const textEN = {
  title: "ğŸŒ TAAA Semanticâ€“Co-Word Analyzer",
  subtitle: "Multilingual Semantic Network & TAAA Theme Assignment Tool",
  modeLabel: "Select Analysis Mode:",
  analyzeBtn: "ğŸš€ Analyze",
  spinnerSteps: [
    "â³ Processingâ€¦ please wait",
    "ğŸ” Analyzing textâ€¦",
    "ğŸ§  Extracting semantic themesâ€¦",
    "ğŸ¨ Rendering visual mapsâ€¦"
  ],
  engine: "ğŸ” Engine: detectingâ€¦",
  footer: "Try Abstract Mode with multilingual texts or Co-Word Mode with animal attributes<br>Â© 2025 Smile Chien Â· TAAA Semanticâ€“Co-Word Analyzer v6.1"
};

const textZH = {
  title: "ğŸŒ TAAA èªç¾©å…±è©åˆ†æå™¨",
  subtitle: "å¤šèªè¨€èªç¾©ç¶²çµ¡èˆ‡ä¸»é¡Œåˆ†é…å·¥å…·",
  modeLabel: "é¸æ“‡åˆ†ææ¨¡å¼ï¼š",
  analyzeBtn: "ğŸš€ é–‹å§‹åˆ†æ",
  spinnerSteps: [
    "â³ æ­£åœ¨è™•ç†ï¼Œè«‹ç¨å€™â€¦",
    "ğŸ” åˆ†æä¸­â€¦",
    "ğŸ§  æ­£åœ¨æ“·å–èªç¾©ä¸»é¡Œâ€¦",
    "ğŸ¨ æ­£åœ¨ç”Ÿæˆè¦–è¦ºåŒ–åœ–è¡¨â€¦"
  ],
  engine: "ğŸ” å¼•æ“ï¼šè‡ªå‹•åµæ¸¬ä¸­â€¦",
  footer: "å¯å˜—è©¦å¤šèªæ‘˜è¦æ¨¡å¼æˆ–å‹•ç‰©å±¬æ€§å…±è©æ¨¡å¼<br>Â© 2025 Smile Chien Â· TAAA èªç¾©å…±è©åˆ†æå™¨ v6.1"
};

// ======== Detect and Apply ========
function detectLang() {
  const lang = navigator.language || navigator.userLanguage;
  return lang.startsWith("zh") ? "zh" : "en";
}

function applyLang(lang) {
  const t = lang === "zh" ? textZH : textEN;
  document.getElementById("title").innerHTML = t.title;
  document.getElementById("subtitle").innerHTML = t.subtitle;
  document.getElementById("modeLabel").innerHTML = t.modeLabel;
  document.getElementById("analyzeBtn").innerHTML = t.analyzeBtn;
  document.getElementById("engineIndicator").innerHTML = t.engine;
  document.getElementById("footer").innerHTML = t.footer;
  localStorage.setItem("taaa_lang", lang);
}

// ======== Language Toggle ========
document.getElementById("toggleLang").addEventListener("click", () => {
  const current = localStorage.getItem("taaa_lang") || detectLang();
  const next = current === "zh" ? "en" : "zh";
  applyLang(next);
});

// ======== Initialize ========
applyLang(localStorage.getItem("taaa_lang") || detectLang());

// ======== Form Submission + Spinner ========
const form = document.getElementById('uploadForm');
const spinner = document.getElementById('spinner');
const indicator = document.getElementById('engineIndicator');
const resultLink = document.getElementById('resultLink');
let spinnerTimer;

form.addEventListener('submit', async (e) => {
  e.preventDefault();
  const fileInput = document.getElementById('file');
  const mode = document.getElementById('mode').value;
  if (!fileInput.files.length) return;

  const lang = localStorage.getItem("taaa_lang") || detectLang();
  const t = lang === "zh" ? textZH : textEN;
  let i = 0;

  spinner.style.display = 'block';
  spinner.textContent = t.spinnerSteps[0];
  indicator.textContent = lang === "zh"
      ? "ğŸ” å¼•æ“ï¼šè‡ªå‹•é¸æ“‡ä¸­ï¼ˆGPT / TF-IDFï¼‰â€¦"
      : "ğŸ” Engine: auto-selecting (GPT / TF-IDF)â€¦";
  resultLink.innerHTML = '';

  // Dynamic spinner text every 2.5 seconds
  spinnerTimer = setInterval(() => {
    i = (i + 1) % t.spinnerSteps.length;
    spinner.textContent = t.spinnerSteps[i];
  }, 2500);

  const data = new FormData();
  data.append('file', fileInput.files[0]);
  data.append('mode', mode);

  try {
    const response = await fetch('/analyze_csv', { method: 'POST', body: data });
    const html = await response.text();
    clearInterval(spinnerTimer);
    document.open(); document.write(html); document.close();
  } catch {
    clearInterval(spinnerTimer);
    spinner.style.display = 'none';
    indicator.textContent = lang === "zh"
      ? "âŒ åˆ†ææ™‚ç™¼ç”ŸéŒ¯èª¤ã€‚"
      : "âŒ Error during analysis.";
  }
});
</script>
</body>
</html>

