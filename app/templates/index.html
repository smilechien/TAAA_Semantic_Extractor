<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TAAA Semantic Analyzer</title>
  <style>
    body { font-family: 'Segoe UI','Noto Sans TC',sans-serif; background:#f9fafc; margin:40px; color:#222; }
    h1 { color:#007ACC; }
    .upload-box { background:#fff; border:2px dashed #007ACC; border-radius:12px; padding:30px; text-align:center; }
    #preview { margin-top:20px; background:#fff; border:1px solid #ccc; border-radius:10px; padding:10px; display:none; overflow-x:auto; }
    table { border-collapse:collapse; width:100%; margin-top:5px; }
    th,td { border:1px solid #ddd; padding:6px; text-align:left; }
    th { background:#007ACC; color:white; }
    #status { margin-top:20px; font-size:15px; color:#007ACC; display:none; }
    #spinner { display:inline-block; width:18px; height:18px; border:3px solid #007ACC; border-top:3px solid transparent; border-radius:50%; animation:spin 1s linear infinite; margin-right:8px; vertical-align:middle; }
    @keyframes spin { from {transform:rotate(0);} to {transform:rotate(360deg);} }
    button { background:#007ACC; color:white; padding:10px 20px; border:none; border-radius:6px; cursor:pointer; font-size:15px; }
    button:hover { background:#005c9a; }
  </style>
</head>
<body>
  <h1>ğŸ“Š Co-Word Theme Analyzer (TAAA)</h1>
  <p>Upload a text-only CSV (each cell = keyword or phrase).  
     The app auto-detects co-occurrences, computes H-theme distribution,  
     and generates 5 downloadable outputs.</p>

  <div class="upload-box">
    <form id="uploadForm" enctype="multipart/form-data" method="post" action="/analyze_csv">
      <input type="file" name="file" id="fileInput" accept=".csv" required><br><br>
      <button type="submit">ğŸš€ Analyze</button>
    </form>
  </div>

  <div id="preview">
    <h3>ğŸ“‹ é è¦½å‰ 5 ç­†è³‡æ–™ (Preview Top 5 Rows)</h3>
    <div id="tableContainer"></div>
  </div>

  <div id="status"><div id="spinner"></div> åˆ†æä¸­...è«‹ç¨å€™ (Analyzing... Please wait)</div>

  <script>
    // ---------- UTF-8 safe CSV preview ----------
    document.getElementById('fileInput').addEventListener('change', function(evt) {
      const file = evt.target.files[0];
      if (!file) return;
      const reader = new FileReader();

      // âœ… read as ArrayBuffer then decode properly
      reader.onload = function(e) {
        const decoder = new TextDecoder('utf-8');
        let text = decoder.decode(e.target.result);
        // fallback Big5 decoding if Chinese looks broken
        if (text.includes(" ")) {
          try { text = new TextDecoder('big5').decode(e.target.result); } catch {}
        }

        const rows = text.split(/\r?\n/).slice(0, 6);
        const data = rows.map(r => r.split(','));
        let html = '<table><thead><tr>';
        html += data[0].map(h => `<th>${h}</th>`).join('');
        html += '</tr></thead><tbody>';
        for (let i = 1; i < data.length; i++) {
          if (!data[i].join('').trim()) continue;
          html += '<tr>' + data[i].map(c => `<td>${c}</td>`).join('') + '</tr>';
        }
        html += '</tbody></table>';
        document.getElementById('tableContainer').innerHTML = html;
        document.getElementById('preview').style.display = 'block';
      };
      reader.readAsArrayBuffer(file);
    });

    // ---------- Show spinner on submit ----------
    document.getElementById('uploadForm').addEventListener('submit', function() {
      document.getElementById('status').style.display = 'block';
    });
  </script>
</body>
</html>
