<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>ğŸŒ TAAA Semanticâ€“Co-Word Analyzer</title>
<style>
body {
  font-family: 'Segoe UI','Noto Sans TC',sans-serif;
  background: #f6f7fb;
  text-align: center;
  margin: 40px;
}
.container {
  background: #fff;
  padding: 30px;
  border-radius: 14px;
  box-shadow: 0 2px 10px rgba(0,0,0,0.1);
  display: inline-block;
  width: 520px;
}
h1 { margin-top: 0; color: #2a2a2a; }
h2 { color: #555; font-weight: 400; margin-top: -5px; }
label { font-weight: bold; }
button {
  margin-top: 15px;
  background: #0078d4;
  color: white;
  border: none;
  padding: 10px 24px;
  border-radius: 6px;
  cursor: pointer;
  font-size: 15px;
}
button:hover { background: #005999; }
select, input[type=file] { margin-top: 10px; }
.spinner { display: none; margin-top: 20px; font-style: italic; color: #666; }
.indicator { margin-top: 10px; font-size: 15px; font-weight: 600; }
footer { margin-top: 25px; font-size: 13px; color: #888; }
table { border-collapse: collapse; margin: 15px auto; font-size: 13px; }
td,th { border: 1px solid #ccc; padding: 4px 8px; }
#modeSummary { font-size: 13px; color: #777; margin-top: 5px; }

/* blinking mode colors */
.blink-green {
  animation: blinkGreen 1s linear infinite;
  color: green;
}
.blink-blue {
  animation: blinkBlue 1s linear infinite;
  color: #0078d4;
}
@keyframes blinkGreen {50%{opacity:0.5;}}
@keyframes blinkBlue {50%{opacity:0.5;}}
</style>
</head>
<body>
<div class="container">
  <h1>ğŸŒ TAAA Semanticâ€“Co-Word Analyzer</h1>
  <h2>Multilingual Semantic Network & TAAA Theme Assignment Tool</h2>

  <form id="uploadForm" enctype="multipart/form-data">
    <input type="file" id="file" name="file" accept=".csv" required><br>
    <button type="submit">ğŸš€ Analyze</button>
  </form>

  <div class="spinner" id="spinner">â³ Analyzingâ€¦ / åˆ†æä¸­â€¦</div>
  <div class="indicator" id="engineIndicator">ğŸ” Waiting for file...</div>
  <div id="modeSummary"></div>
  <div id="preview"></div>
  <div id="resultLink"></div>

  <h3>ğŸ“‚ Sample Datasets / ç¯„ä¾‹è³‡æ–™é›†</h3>
  <p>You can try these demo files to explore both modes:</p>
  <a href="/static/abstract_sample.csv" download>ğŸ§  Download Abstract Sample</a><br>
  <a href="/static/coword_sample.csv" download>ğŸ¾ Download Co-Word Sample</a><br>
  <a href="/static/readme_dataset_info.csv" download>ğŸ“˜ Download Dataset Info</a>

  <footer>
    Try Abstract Mode (1 column) or Co-Word Mode (multi-column)<br>
    Â© 2025 Smile Chien Â· TAAA Semanticâ€“Co-Word Analyzer v10.0
  </footer>
</div>

<script>
const form = document.getElementById('uploadForm');
const fileInput = document.getElementById('file');
const spinner = document.getElementById('spinner');
const indicator = document.getElementById('engineIndicator');
const modeSummary = document.getElementById('modeSummary');
const previewDiv = document.getElementById('preview');
const resultLink = document.getElementById('resultLink');

fileInput.addEventListener('change', async (e) => {
  const file = e.target.files[0];
  if (!file) return;
  const text = await file.text();
  const rows = text.split(/\r?\n/).slice(0,6).map(r=>r.split(','));
  if (rows.length <= 1) return;

  let html = "<table><tr>" + rows[0].map(c=>`<th>${c}</th>`).join('') + "</tr>";
  for(let i=1;i<rows.length;i++)
    html += "<tr>" + rows[i].map(c=>`<td>${c}</td>`).join('') + "</tr>";
  html += "</table>";
  previewDiv.innerHTML = html;

  const mode = rows[0].length === 1 ? 'abstract' : 'coword';
  if (mode === 'abstract') {
    indicator.textContent = "ğŸ§  Detected Abstract Mode";
    indicator.className = "indicator blink-green";
    modeSummary.textContent = "Detected single-column file â†’ will use abstract analysis / åµæ¸¬åˆ°å–®æ¬„æ‘˜è¦æ¨¡å¼";
  } else {
    indicator.textContent = "ğŸ¾ Detected Co-Word Mode";
    indicator.className = "indicator blink-blue";
    modeSummary.textContent = "Detected multi-column file â†’ will use co-word analysis / åµæ¸¬åˆ°å¤šæ¬„å…±è©æ¨¡å¼";
  }
});

form.addEventListener('submit', async (e) => {
  e.preventDefault();
  const file = fileInput.files[0];
  if (!file) return;
  spinner.style.display = 'block';
  resultLink.innerHTML = '';
  const data = new FormData();
  data.append('file', file);
  try {
    const response = await fetch('/analyze_csv', { method: 'POST', body: data });
    const html = await response.text();
    document.open(); document.write(html); document.close();
  } catch {
    spinner.style.display = 'none';
    indicator.textContent = 'âŒ Error during analysis.';
  }
});
</script>
</body>
</html>
