<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>TAAA Semantic Extractor | èªç¾©é—œéµè©èƒå–ç³»çµ±</title>
<style>
  body {
    font-family: "Segoe UI", "Noto Sans TC", sans-serif;
    background: var(--bg, #fafafa);
    color: var(--fg, #222);
    text-align: center;
    margin: 40px;
    transition: background 0.3s, color 0.3s;
  }
  h1 {
    color: #0066cc;
  }
  .dark {
    --bg: #1e1e1e;
    --fg: #f5f5f5;
  }
  .container {
    border: 2px dashed #bbb;
    border-radius: 10px;
    padding: 30px;
    width: 400px;
    margin: 20px auto;
    cursor: pointer;
  }
  .container.dragover {
    border-color: #0066cc;
    background: #f0f8ff;
  }
  input[type="file"] {
    display: none;
  }
  button {
    background: #0066cc;
    color: white;
    border: none;
    border-radius: 6px;
    padding: 10px 18px;
    font-size: 15px;
    cursor: pointer;
    margin: 8px;
  }
  button:hover {
    background: #004999;
  }
  #progress {
    width: 80%;
    height: 20px;
    background: #eee;
    border-radius: 10px;
    margin: 15px auto;
    overflow: hidden;
  }
  #bar {
    width: 0%;
    height: 100%;
    background: linear-gradient(90deg, #00c6ff, #0072ff);
    transition: width 0.3s;
  }
  #toggleMode {
    position: absolute;
    top: 10px;
    right: 20px;
    cursor: pointer;
    font-size: 14px;
    color: #555;
  }
  .sample-links a {
    display: inline-block;
    margin: 6px;
    color: #0066cc;
    text-decoration: none;
  }
  .sample-links a:hover {
    text-decoration: underline;
  }
</style>
</head>
<body>
  <div id="toggleMode">ğŸŒ Light Mode / äº®è‰²æ¨¡å¼</div>

  <h1>TAAA Semantic Extractor<br><small>èªç¾©é—œéµè©èƒå–ç³»çµ±</small></h1>
  <p>
    ä¸Šå‚³åŒ…å« <b>abstract</b> æ¬„ä½çš„ CSV æª”æ¡ˆï¼Œç³»çµ±å°‡ä½¿ç”¨ <b>GPT-4o-mini</b> è‡ªå‹•èƒå–èªç¾©é—œéµè©ã€‚<br>
    Upload a CSV file containing an <b>abstract</b> column â€” the system will automatically extract semantic keywords using <b>GPT-4o-mini</b>.
  </p>

  <!-- ğŸ“ File upload area -->
  <div class="container" id="dropZone">
    <p id="dropText">ğŸ“„ æ‹–æ”¾æˆ–é»æ“Šä»¥ä¸Šå‚³ CSV æª”æ¡ˆ / Drag & Drop or Click to Upload CSV File</p>
    <input type="file" id="fileInput" accept=".csv" />
  </div>

  <!-- ğŸš€ Action button -->
  <button id="uploadBtn">â¬†ï¸ ä¸Šå‚³ä¸¦åˆ†æ / Upload & Analyze</button>

  <div id="progress"><div id="bar"></div></div>
  <p id="status"></p>

  <!-- ğŸ“¥ Sample download links -->
  <div class="sample-links">
    <p>ğŸ“‚ ç¯„ä¾‹æª”æ¡ˆ / Sample Files</p>
    <a href="/sample_abstracts.csv" download>ğŸ“¥ ä¸­æ–‡ç¯„ä¾‹ CSV (Chinese Only)</a>
    <a href="/sample_abstracts_bilingual.csv" download>ğŸŒ ä¸­è‹±å°ç…§ç¯„ä¾‹ CSV (Bilingual)</a>
  </div>

  <script>
    const dropZone = document.getElementById("dropZone");
    const fileInput = document.getElementById("fileInput");
    const uploadBtn = document.getElementById("uploadBtn");
    const bar = document.getElementById("bar");
    const status = document.getElementById("status");
    const toggleMode = document.getElementById("toggleMode");

    // ğŸŒ— Theme toggle
    toggleMode.addEventListener("click", () => {
      document.body.classList.toggle("dark");
      toggleMode.textContent = document.body.classList.contains("dark")
        ? "ğŸŒ™ Dark Mode / æš—è‰²æ¨¡å¼"
        : "ğŸŒ Light Mode / äº®è‰²æ¨¡å¼";
    });

    // ğŸ“ Drag & Drop logic
    dropZone.addEventListener("click", () => fileInput.click());
    dropZone.addEventListener("dragover", e => {
      e.preventDefault();
      dropZone.classList.add("dragover");
    });
    dropZone.addEventListener("dragleave", () => dropZone.classList.remove("dragover"));
    dropZone.addEventListener("drop", e => {
      e.preventDefault();
      dropZone.classList.remove("dragover");
      fileInput.files = e.dataTransfer.files;
      status.textContent = `ğŸ“‚ å·²é¸æ“‡ Selected: ${fileInput.files[0].name}`;
    });

    // ğŸš€ Upload and analyze
    uploadBtn.addEventListener("click", async () => {
      const file = fileInput.files[0];
      if (!file) {
        alert("âš ï¸ è«‹å…ˆé¸æ“‡ä¸€å€‹ CSV æª”æ¡ˆã€‚\nPlease select a CSV file first.");
        return;
      }

      const formData = new FormData();
      formData.append("file", file);

      bar.style.width = "20%";
      status.textContent = "â« ä¸Šå‚³ä¸­ / Uploading...";

      try {
        const response = await fetch("/analyze_csv", {
          method: "POST",
          body: formData
        });

        if (!response.ok) throw new Error("ä¼ºæœå™¨éŒ¯èª¤ / Server error");

        bar.style.width = "80%";
        status.textContent = "ğŸ§  åˆ†æä¸­ / Analyzing, please wait...";

        const blob = await response.blob();
        bar.style.width = "100%";

        const link = document.createElement("a");
        link.href = window.URL.createObjectURL(blob);
        link.download = "taaa_keywords.csv";
        link.click();

        status.textContent = "âœ… åˆ†æå®Œæˆï¼Œçµæœå·²è‡ªå‹•ä¸‹è¼‰ï¼ / Analysis complete, file downloaded!";
        setTimeout(() => { bar.style.width = "0%"; }, 3000);
      } catch (err) {
        status.textContent = "âŒ éŒ¯èª¤ / Error: " + err.message;
      }
    });
  </script>
</body>
</html>
